<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="PIC32CX-BZ3 Secure Boot ROM Help" />
<meta name="DC.relation" scheme="URI" content="GUID-F9698DC6-BF78-4773-A5E3-CA7D4F570394.html" />
<meta name="DC.relation" scheme="URI" content="GUID-070C3957-164B-4B25-B4D1-A01BBA16D143.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>PIC32CX-BZ3 Secure Boot ROM Help</title>
<meta name="Microsoft.Help.Id" content="GUID-2085FE66-A762-4CC0-B054-7F98E8AF999A-GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8" />
<meta name="Microsoft.Help.TocParent" content="GUID-2085FE66-A762-4CC0-B054-7F98E8AF999A-GUID-F9698DC6-BF78-4773-A5E3-CA7D4F570394" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB Harmony PIC32CX-BZ System Services Reference 4 10/2023" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8">

<h1 class="title topictitle1" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-50E900D8-C939-4548-B6B2-A41D89A1BAAA" style="">PIC32CX-BZ3 Secure Boot ROM Help</h1>
<div class="body">
        <p class="p">The Boot ROM allows to ensure the integrity of the device at boot.</p>

        <p class="p">An immutable boot sequence (Secure Boot Code) is implemented into a ROM called the Secure
            Boot ROM. The Secure Boot ROM manages Test mode entry, firmware and data authentication,
            firmware loading, and necessary system configurations.</p>

        <p class="p">For secure boot support on the PIC32CX-BZ3, a 64K ROM is dedicated to the secure boot
            firmware. Keys and credentials required for code authentication are stored as a part of
            eFuses. On every reset, secure boot firmware authenticates the rest of the program image
            in the Flash.</p>

        <div class="p"><strong class="ph b"><u class="ph u">Features</u></strong><ul class="ul" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__UL_QDH_5CY_XRB">
                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-F52C4978-469C-434C-BDB4-78F105693386">Immutable boot support with
                    ROM</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-2DB19E83-86E2-4E8A-912E-CB9E67C7AB1D">Firmware code authentication
                    (Only at Boot time)</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-288BFB1D-1360-45D6-8990-D1DF2BCA3C82">Support for immutable keys</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-324B3FBC-8935-4136-A7C1-C06D1CF4663D">Microchip or customer
                    programmable secure boot key</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-3EFFA0C5-2BEB-4C67-9D74-154D63A37DC4">Support for secure execution
                    environment</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-B837176F-34DB-400D-BD54-E16C08AA4F23">Supports Anti-roll back</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-2EC82461-B029-4972-9C46-4485147F5DF9">Support for firmware readable life cycle counter</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-D697FC94-426E-425C-8D87-187BA5A040B9">Defined system boot state</li>

            </ul>
</div>

        <p class="p"><strong class="ph b"><u class="ph u">Boot ROM Flow</u></strong></p>

        <div class="fig fignone" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__FIG_DGN_JMM_SXB"><div class="figcap"><span class="fig--title-label">Figure 1. </span>Boot ROM Flow</div>
            
            <br /><img class="image" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__IMAGE_EGN_JMM_SXB" src="GUID-5A155C3D-86A5-4BE5-A51E-1D7D7D6187C1-low.png" /><br />
        </div>

        <p class="p">Once the device comes out of reset, Boot ROM firmware checks if Test mode is triggered,
            if not it continues with chip initialization. After the completion of chip
            initialization, the bootstrap code checks for a valid firmware image and executes. If
            the device does not find any valid image, it jumps to Secure Safe mode. For validating
            the firmware image, the bootstrap code uses the security library depending on the
            firmware images authentication scheme specified for that firmware.</p>

        <p class="p">Firmware programming is handled by Device Firmware Update (DFU) using Device Service Unit
            (DSU). DSU supports the Debug mode, also it implements a CoreSight Debug ROM that
            provides device identification as well as identification of other debug components
            within the system. See <em class="ph i">Device Service Unit (DSU)</em> from Related Links.</p>

        <div class="p"> The following options are valid images for a PIC32CX-BZ3 device:<ul class="ul" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__UL_GWJ_FFF_SXB">
                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-F4E07307-86F4-432F-B6BB-8C835CD00DB8">An image with valid structure
                    (defined in <a class="xref" href="#GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__TABLE_TCM_KGM_SXB">Table 1</a>) and without using
                    any authentication scheme.</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-6F9E229A-101F-48F9-A4D7-C1D40CB31902">An image with a valid structure
                    (defined in<a class="xref" href="#GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__TABLE_TCM_KGM_SXB">Table 1</a> ) with an
                    authentication scheme supported by the device. For supporting the authentication
                    scheme using public key cryptography, EFUSE must have a valid
                    SECURE_BOOT_KEY.</li>

                <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-ABB42896-54C0-4D46-8551-4658DFD5C0E7">If the device is secured (with
                    SECURE_BOOT_KEY! = 0), the valid image must always use the ECDSA p384 + SHA 384
                    or ECDSA p256 + SHA 256 for authentication.</li>

            </ul>
</div>

        <p class="p"><strong class="ph b"><u class="ph u">Firmware Image Format</u></strong></p>

        <p class="p">Firmware image comes with a metadata header, metadata payload, and metadata footer that
            gives the ROM firmware information about location of the firmware image, security
            decryption/ authentication information, sequence number and more. Application (Firmware
            Image) can only be executed from Embedded Flash or Boot Flash.</p>

        <p class="p">The following table provides details about the contents of each firmware image.</p>

        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__TABLE_TCM_KGM_SXB" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 1. </span>Firmware Image Description</span></caption>
                <col style="width:33.33333333333333%" />
                <col style="width:33.33333333333333%" />
                <col style="width:33.33333333333333%" />
                <thead class="thead" style="text-align:left;">
                    <tr class="row">
                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e131"><span><strong class="ph b">Offset</strong></span></th>

                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e135"><span><strong class="ph b">Name</strong></span></th>

                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e139"><span><strong class="ph b">Description</strong></span></th>

                    </tr>

                </thead>

                <tbody class="tbody">
                    <tr class="row">
                        <td class="entry cellrowborder" colspan="3" style="vertical-align:middle;" headers="d3429e131 d3429e135 d3429e139 "><span><strong class="ph b">Metadata Header</strong></span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x00:0x03</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>SEQ_NUM</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Metadata sequence number of the image in Little Endian</p>

                            <p class="p">(LE). Monotonically decreasing image index. Values of 0 or</p>

                            <p class="p">0xFFFFFFFF indicate that the image is invalid. Boot ROM</p>

                            <p class="p">Image selection algorithm will prefer a valid image with lowest
                                sequence number.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x04</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>MD_REV</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Support Metadata Header Version</p>

                            <p class="p"><strong class="ph b">Note: </strong>This field must be set to 0x01 for this version of
                                metadata header.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x05</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>CONT_IDX</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>0x01 – Plain firmware image</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x06:0x09</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>IDENTIFIER</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>MCHP ASCII String Identifier.</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x0A</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>MD_AUTH_MTHD</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Metadata authentication method.</p>

                            <p class="p">0x00 – None</p>

                            <p class="p">0x02 – ECDSA p256 + SHA256</p>

                            <p class="p">0x03 – ECDSA p256 + SHA2-384</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x0B</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>MD_AUTH_KEY</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Key index for authenticating metadata.</p>

                            <p class="p">0x00 – Secure boot Key</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x0C</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>PL_DEC_MTHD</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Payload decryption method.</p>

                            <p class="p">0x00 – Plain</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x0D</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>PL_DEC_KEY</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>Not applicable.</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x0E:0x0F</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>PL_LEN</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>Metadata payload length. The payload length for this version must be
                            0x74.</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" colspan="3" style="vertical-align:middle;" headers="d3429e131 d3429e135 d3429e139 "><span><strong class="ph b">Metadata Payload = Firmware Image
                                Header</strong></span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x10:0x13</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_REV</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>Firmware image revision (little endian).</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x14:0x17</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_SRC_ADDR</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware Image source address.</p>

                            <p class="p">The source address of the firmware image in persistent storage. This
                                field is not authenticated and the OTA or Bootloader can rewrite it
                                based on the image storage location selected.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x18:0x1B</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_DST_ADDR</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware image destination address.</p>

                            <p class="p">The destination address will be used as the jump address during the
                                application transition. As the ROM firmware must copy this header
                                structure into executable memory, the destination address must not
                                be less than 0x200.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x1C:0x1F</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_LEN</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware image length.</p>

                            <p class="p">The firmware image length must be a multiple of 4096 (Count)
                                bytes.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x20</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_AUTH_MTHD</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware image authentication method.</p>

                            <p class="p">0x00 – None</p>

                            <p class="p">0x02 – ECDSA p256 + SHA-256</p>

                            <p class="p">0x03 – ECDSA p384 + SHA2-384</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x21</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_AUTH_KEY</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware image authentication key index.</p>

                            <p class="p">0x00 – Secure boot key</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x22</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_DEC_MTHD</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">Firmware image decryption method.</p>

                            <p class="p">0x00 – Plain</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x23</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_DEC_KEY</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>Not applicable.</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x24:0x83</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>FW_IMG_SIG</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">The following are the options of firmware image signature: The
                                concatenated R and S term of the ECDSA signature (P-256) of the
                                SHA-256 hash of the firmware image specified by FW_IMG_SRC_ADDR and
                                FW_IMG_LEN.</p>

                            <p class="p">(or)</p>

                            <p class="p">The concatenated R and S term of the ECDSA signature (P-384) of the
                                SHA-384 hash of the firmware image specified by FW_IMG_SRC_ADDR and
                                FW_IMG_LEN.</p>

                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" colspan="3" style="vertical-align:middle;" headers="d3429e131 d3429e135 d3429e139 "><span><strong class="ph b">Metadata Footer</strong>
                        </span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e131 "><span>0x84:0xE3</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e135 "><span>MD_SIG</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e139 "><span>
                            <p class="p">The following are the options of metadata payload signature: The
                                concatenated R and S term of the ECDSA signature (P-256) of the
                                SHA-256 hash of the firmware image specified by FW_IMG_SRC_ADDR and
                                FW_IMG_LEN.</p>

                            <p class="p">(or)</p>

                            <p class="p">The concatenated R and S term of the ECDSA signature (P-384) of the
                                SHA-384 hash of the firmware image specified by FW_IMG_SRC_ADDR and
                                FW_IMG_LEN.</p>

                        </span></td>

                    </tr>

                </tbody>

            </table>
</div>

        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__TABLE_G54_H3M_SXB" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 2. </span>Firmware Images Lookup Table</span></caption>
                <col style="width:33.33333333333333%" />
                <col style="width:33.33333333333333%" />
                <col style="width:33.33333333333333%" />
                <thead class="thead" style="text-align:left;">
                    <tr class="row">
                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e524"><span> </span></th>

                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e526"><span>Address</span></th>

                        <th class="entry cellrowborder" style="vertical-align:middle;" id="d3429e529"><span>Size (bytes)</span></th>

                    </tr>

                </thead>

                <tbody class="tbody">
                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 0 metadata</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0080_0000</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>512</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 0</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0080_0200</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>15872</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 2 metadata</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0100_0000</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>512</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 2</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0100_0200</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>Max: 523776</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 3 metadata</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0104_0000</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>512</span></td>

                    </tr>

                    <tr class="row">
                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e524 "><span>Image 3</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e526 "><span>0x0104_0200</span></td>

                        <td class="entry cellrowborder" style="vertical-align:middle;" headers="d3429e529 "><span>Max: 261632</span></td>

                    </tr>

                </tbody>

            </table>
</div>

        <ul class="ul" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__UL_SVD_D3F_SXB">
            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-4C95CC9D-4D2B-45CD-906B-C36F9406956C">Boot Flash image 0</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-57C57DC5-D020-4195-9FF2-F88DFEAEFD27">Embedded Flash image 0</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-5C78C5DB-C30C-4550-9F05-C8B7F12C433D">Embedded Flash image 1 in the second panel (only possible if the image is less than
                256 KB; including headers)</li>

        </ul>

        <p class="p">For an embedded Flash only device, the ROM firmware checks for a valid image in three
            memory locations, see <a class="xref" href="#GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__TABLE_G54_H3M_SXB">Table 2</a>.</p>

        <p class="p"><strong class="ph b"><u class="ph u">DSU Mode Entry</u></strong></p>

        <p class="p">Immediately after resetting, the ROM firmware reads the condition of Code Protect, and
            Device Secured State bits to determine the Device Security state. Security state the ROM
            firmware needs to perform specific actions.</p>

        <p class="p"><strong class="ph b"><u class="ph u">Serial Debugging and Programming</u></strong></p>

        <ul class="ul" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__UL_K2L_VGF_SXB">
            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-2885DBDB-0826-473C-A6A2-A9CE22D91FAE">The device is not code-protected and unsecured, supports debugging and programming
                features.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-D365842F-913F-47BA-BBE2-4851CE0F3349">The device is code-protected and unsecured, supports debugging, erase and
                programming features.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-59FF0E4F-A472-457E-8507-D10EBFD145DF">The device is not code-protected and secured, does not support the debugging
                feature, and supports the programming feature.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-283AE10C-8188-4CAF-952C-8F0803DBA0C4">The device is not code-protected and secured, does not support the debugging
                feature, erase and supports the programming feature.</li>

        </ul>

        <p class="p"><strong class="ph b"><u class="ph u">Chip Initialization</u></strong></p>

        <p class="p">All the necessary hardware modules that the BOOT ROM program uses will be initialized –
            System clock, Interrupts, and more.</p>

        <p class="p"><strong class="ph b"><u class="ph u">Firmware Authentication and Loading</u></strong></p>

        <p class="p">The firmware image validation block is the primary block that ensures the
            integrity/authenticity of the images that are run on a secured device.</p>

        <p class="p"><strong class="ph b"><u class="ph u">Firmware Image Validation – Secured Mode</u></strong></p>

        <p class="p">The following are the main blocks in the process of image validation:</p>

        <ol class="ol" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__OL_C2J_PGF_SXB">
            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-3425D93B-A73E-4370-86B4-33636589D3A9"><span class="indent-level-default">1.</span>READ_CFG - Read device configuration (device id, secure elements). Secure elements
                and device id information can be accessed from EFUSE memory.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-66E4A423-5DBA-4EE3-AFB3-0264B96A6A3C"><span class="indent-level-default">2.</span>LOOKUP_METADATA - Search for valid firmware image metadata with the lowest sequence
                number.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-4B32DE33-2B21-4D05-81DE-2C5F76C92154"><span class="indent-level-default">3.</span>AUTHENTICATE_IMAGE - Authenticate the image based on the security configuration of
                the device (EFUSE) and as indicated by its metadata. The firmware image header
                dictates the authentication scheme. Secure Boot is done on successful authentication
                of the firmware.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-5E9AEC0B-6B42-40AB-9F95-58EF1B348EB5"><span class="indent-level-default">4.</span>RUN_APPLICATION - If the valid image is in embedded flash and is available in its
                destination address space, jump to the DST_ADDR as indicated by its metadata.</li>

            <li class="li" id="GUID-04D7627E-7290-429B-88B9-2EFFFA11A3A8__GUID-7BC928F2-B8B8-4754-8300-F2D966DA99CB"><span class="indent-level-default">5.</span>SECURE_SAFE_MODE - Secure Safe mode is a <code class="ph codeph">while 1() loop</code> in the
                firmware, where the device is waiting for a valid application image to execute.</li>

        </ol>

        <p class="p"><strong class="ph b"><u class="ph u">Firmware Image Validation – Unsecured Mode</u></strong></p>

        <p class="p">In the Unsecured mode, the device is not checked for authentication scheme that needs
            SECURE_BOOT_KEY.</p>

        <p class="p">If the device is unsecured (and SECURE_BOOT_KEY is invalid and the Device Secured state
            is not set), the bootstrap code looks for valid images (valid sequence number, header
            and more.). Root of trust cannot be possible in this scenario.</p>

</div>

<div class="related-links">
<ul class="ullinks">
<li class="link ulchildlink"><strong><a href="GUID-070C3957-164B-4B25-B4D1-A01BBA16D143.html">PIC32CX-BZ3 Secure Boot ROM Usage</a></strong><br />
PIC32CX-BZ3 Secure Boot ROM Library Usage</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-F9698DC6-BF78-4773-A5E3-CA7D4F570394.html">PIC32CX-BZ3 System Services</a></div>
</div>
</div></body>
</html>